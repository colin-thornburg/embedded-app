version: 2

semantic_models:
  - name: claims
    description: "Claims data with member and company relationships"
    model: ref('fct_claims')
    defaults:
      agg_time_dimension: claim_date
    
    entities:
      - name: claim
        type: primary
        expr: claim_id
      - name: member
        type: foreign
        expr: member_id
      - name: company
        type: foreign
        expr: company_id
    
    dimensions:
      - name: claim_date
        type: time
        type_params:
          time_granularity: day
        expr: claim_date
      - name: claim_type
        type: categorical
        expr: claim_type
      - name: claim_status
        type: categorical
        expr: claim_status
      - name: provider_name
        type: categorical
        expr: provider_name
      - name: diagnosis_description
        type: categorical
        expr: diagnosis_description
      - name: company_id
        type: categorical
        expr: company_id
    
    measures:
      - name: total_claim_amount
        description: "Total claim amount"
        agg: sum
        expr: claim_amount
      - name: paid_amount
        description: "Amount paid by insurance"
        agg: sum
        expr: paid_amount
      - name: member_responsibility
        description: "Amount owed by member"
        agg: sum
        expr: member_responsibility
      - name: claim_count
        description: "Number of claims"
        agg: count
        expr: claim_id

  - name: members
    description: "Member information with plan details"
    model: ref('dim_members')
    defaults:
      agg_time_dimension: enrollment_date
    
    entities:
      - name: member
        type: primary
        expr: member_id
      - name: company
        type: foreign
        expr: company_id
    
    dimensions:
      - name: first_name
        type: categorical
        expr: first_name
      - name: last_name
        type: categorical
        expr: last_name
      - name: email
        type: categorical
        expr: email
      - name: department
        type: categorical
        expr: department
      - name: plan_type
        type: categorical
        expr: plan_type
      - name: is_primary
        type: categorical
        expr: is_primary
      - name: company_name
        type: categorical
        expr: company_name
      - name: enrollment_date
        type: time
        type_params:
          time_granularity: day
        expr: enrollment_date
    
    measures:
      - name: member_count
        description: "Count of members"
        agg: count_distinct
        expr: member_id

metrics:
  - name: total_claim_amount
    description: "Total dollar amount of all claims"
    type: simple
    label: "Total Claim Amount"
    type_params:
      measure: total_claim_amount
  
  - name: total_claims_count
    description: "Total number of claims"
    type: simple
    label: "Total Claims Count"
    type_params:
      measure: claim_count
  
  - name: total_member_responsibility
    description: "Total member responsibility amount"
    type: simple
    label: "Total Member Responsibility"
    type_params:
      measure: member_responsibility
  
  - name: total_paid_by_insurance
    description: "Total amount paid by insurance"
    type: simple
    label: "Insurance Paid Amount"
    type_params:
      measure: paid_amount
  
  - name: active_members
    description: "Count of active members"
    type: simple
    label: "Active Members"
    type_params:
      measure: member_count
  
  - name: ytd_member_responsibility
    description: "Member responsibility amount year-to-date"
    type: simple
    label: "YTD Member Responsibility"
    type_params:
      measure: member_responsibility
    filter: |
      {{ Dimension('claim__claim_date') }} >= '2024-01-01'